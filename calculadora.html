<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Calculadora de Orçamento | Aço Fino</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Playfair+Display:wght@600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { gold: { 400: '#D4AF37', 500: '#C5A028' }, zinc: { 850: '#1f1f22', 950: '#0c0c0c' } },
                    fontFamily: { sans: ['Inter', 'sans-serif'], serif: ['Playfair Display', 'serif'] }
                }
            }
        }
    </script>
    <style>
        /* Impede o zoom automático no iOS quando foca em inputs */
        input { font-size: 16px !important; }
        
        /* Estilo da barra de rolagem customizada pro dropdown */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #1f1f22; }
        ::-webkit-scrollbar-thumb { background: #D4AF37; border-radius: 4px; }
    </style>
</head>
<body class="bg-zinc-950 text-gray-300 font-sans antialiased min-h-screen flex flex-col selection:bg-gold-400 selection:text-black">

    <div class="max-w-3xl w-full mx-auto bg-zinc-900 border-x border-white/5 flex-1 flex flex-col shadow-2xl relative pb-32">
        
        <div class="bg-black/80 backdrop-blur-md p-5 border-b border-white/10 flex items-center justify-between sticky top-0 z-40">
            <div>
                <h1 class="text-xl md:text-2xl font-serif text-white">Calculadora <span class="text-gold-400 italic">Fina</span></h1>
                <p class="text-[10px] md:text-xs text-gray-500 uppercase tracking-widest mt-1">Orçamento Completo</p>
            </div>
            <i class="ph ph-calculator text-3xl text-gold-400"></i>
        </div>

        <div class="p-4 md:p-8 flex-1 flex flex-col gap-6">
            
            <div class="bg-zinc-950 p-4 border border-white/5 rounded-md">
                <h2 class="text-xs font-bold text-gold-400 uppercase tracking-wider mb-4 flex items-center gap-2">
                    <i class="ph ph-magnifying-glass"></i> 1. Inserir Material ou Acessório
                </h2>
                
                <div class="space-y-4">
                    <div class="relative">
                        <label class="block text-xs text-gray-400 mb-1">Digite o material (ex: Tubo 20x20 ou Sapata)</label>
                        <div class="relative">
                            <input type="text" id="input-busca" placeholder="Buscar material..." onkeyup="filtrarMateriais()" autocomplete="off" class="w-full bg-zinc-900 border border-zinc-700 text-white rounded-md p-3 pl-10 focus:outline-none focus:border-gold-400 transition-colors">
                            <i class="ph ph-magnifying-glass absolute left-3 top-3.5 text-gray-400 text-lg"></i>
                        </div>
                        <ul id="dropdown-materiais" class="absolute z-50 w-full bg-zinc-800 border border-zinc-700 mt-1 max-h-60 overflow-y-auto rounded-md shadow-2xl hidden">
                        </ul>
                    </div>
                    
                    <div class="flex gap-3 items-end">
                        <div class="w-1/2">
                            <label class="block text-xs text-gray-400 mb-1" id="label-quantidade">Metros / Qtd.</label>
                            <input type="number" id="input-metros" step="0.1" placeholder="Ex: 2.5 ou 4" class="w-full bg-zinc-900 border border-zinc-700 text-white rounded-md p-3 focus:outline-none focus:border-gold-400 transition-colors">
                        </div>
                        <div class="w-1/2">
                            <button onclick="adicionarMaterial()" class="w-full h-[50px] bg-zinc-800 border border-gold-400/30 hover:bg-gold-400 hover:text-black text-gold-400 text-xs font-bold uppercase tracking-wider rounded-md transition-colors flex justify-center items-center gap-1">
                                <i class="ph ph-plus-circle text-lg"></i> Adicionar
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div>
                <h2 class="text-xs font-bold text-white uppercase tracking-wider mb-2 border-b border-white/10 pb-2">Materiais na Peça</h2>
                <div id="lista-materiais" class="space-y-2 min-h-[80px]">
                    <p class="text-xs text-gray-600 italic py-2">Nenhum material adicionado ainda.</p>
                </div>
            </div>

            <div class="bg-zinc-950 p-4 border border-white/5 rounded-md mt-2">
                <h2 class="text-xs font-bold text-gold-400 uppercase tracking-wider mb-4 flex items-center gap-2">
                    <i class="ph ph-paint-roller"></i> 2. Acabamento & Serviços
                </h2>
                
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-[10px] text-gray-400 mb-1 uppercase tracking-wider">Qtd. Soldas</label>
                        <input type="number" id="qtd-soldas" value="0" oninput="calcularTotal()" class="w-full bg-zinc-900 border border-zinc-700 text-white rounded-md p-3 text-center focus:outline-none focus:border-gold-400">
                    </div>
                    <div>
                        <label class="block text-[10px] text-gray-400 mb-1 uppercase tracking-wider">Valor p/ Solda (R$)</label>
                        <input type="number" id="valor-solda" value="15.00" oninput="calcularTotal()" class="w-full bg-zinc-900 border border-zinc-700 text-white rounded-md p-3 text-center focus:outline-none focus:border-gold-400">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-[10px] text-gray-400 mb-1 uppercase tracking-wider">Metros Pintura</label>
                        <input type="number" id="qtd-pintura" value="0" step="0.1" oninput="calcularTotal()" class="w-full bg-zinc-900 border border-zinc-700 text-white rounded-md p-3 text-center focus:outline-none focus:border-gold-400">
                    </div>
                    <div>
                        <label class="block text-[10px] text-gray-400 mb-1 uppercase tracking-wider">M² Pintura (R$)</label>
                        <input type="number" id="valor-pintura" value="8.00" oninput="calcularTotal()" class="w-full bg-zinc-900 border border-zinc-700 text-white rounded-md p-3 text-center focus:outline-none focus:border-gold-400">
                    </div>
                </div>
            </div>

            <div class="bg-zinc-950 p-4 border border-white/5 rounded-md mt-2">
                <h2 class="text-xs font-bold text-gold-400 uppercase tracking-wider mb-2 flex items-center gap-2">
                    <i class="ph ph-chart-line-up"></i> 3. Margem / Quebra
                </h2>
                <div class="flex items-center gap-4">
                    <div class="w-full">
                        <label class="block text-[10px] text-gray-400 mb-1 uppercase tracking-wider">Margem de Lucro e Imprevistos (%)</label>
                        <input type="number" id="margem-lucro" value="20" oninput="calcularTotal()" class="w-full bg-zinc-900 border border-zinc-700 text-white rounded-md p-3 focus:outline-none focus:border-gold-400">
                    </div>
                    <div class="w-full">
                        <p class="text-[10px] text-gray-500 leading-tight">Adiciona uma porcentagem sobre os custos totais para cobrir discos, energia e garantir a margem final.</p>
                    </div>
                </div>
            </div>

            <div class="bg-zinc-900 border border-zinc-700 rounded-md p-4 mt-2">
                <h2 class="text-xs font-bold text-white uppercase tracking-wider mb-3 flex items-center gap-2 border-b border-zinc-700 pb-2">
                    <i class="ph ph-receipt text-gold-400"></i> 4. Detalhamento dos Custos
                </h2>
                <ul class="space-y-2 text-sm text-gray-400">
                    <li class="flex justify-between">
                        <span>Materiais e Acessórios:</span>
                        <span id="detalhe-materiais" class="text-white font-mono">R$ 0,00</span>
                    </li>
                    <li class="flex justify-between">
                        <span>Mão de Obra (Soldas):</span>
                        <span id="detalhe-solda" class="text-white font-mono">R$ 0,00</span>
                    </li>
                    <li class="flex justify-between border-b border-zinc-700 pb-2">
                        <span>Pintura:</span>
                        <span id="detalhe-pintura" class="text-white font-mono">R$ 0,00</span>
                    </li>
                    <li class="flex justify-between pt-1">
                        <span>Margem de Segurança:</span>
                        <span id="detalhe-margem" class="text-gold-400 font-mono">R$ 0,00</span>
                    </li>
                    <li class="flex justify-between font-bold text-white pt-2 border-t border-zinc-700 mt-2">
                        <span>Total Sugerido:</span>
                        <span id="detalhe-total" class="text-gold-400 font-mono">R$ 0,00</span>
                    </li>
                </ul>
            </div>

        </div>

        <div class="bg-zinc-950 border-t border-gold-400/30 p-4 fixed bottom-0 w-full max-w-3xl z-50 shadow-[0_-10px_20px_rgba(0,0,0,0.5)]">
            <div class="flex justify-between items-center mb-2">
                <div class="text-xs text-gray-400">
                    Custo Bruto: <span id="resumo-custo" class="text-white ml-1 font-mono">R$ 0,00</span>
                </div>
                <div class="text-xs text-gold-400/80">
                    + Margem: <span id="resumo-margem" class="ml-1 font-mono">R$ 0,00</span>
                </div>
            </div>
            <div class="flex justify-between items-end border-t border-white/10 pt-2">
                <div>
                    <span class="block text-[10px] uppercase tracking-widest text-gold-400">Valor Final P/ o Cliente</span>
                    <span id="preco-final" class="text-3xl font-serif text-white font-bold leading-none">R$ 0,00</span>
                </div>
                <button onclick="limparTudo()" class="text-xs bg-red-900/30 text-red-400 px-4 py-2 rounded-md hover:bg-red-900/50 transition-colors">
                    Limpar Tudo
                </button>
            </div>
        </div>
    </div>

    <script>
        const dbMateriais = [
            // TUBOS QUADRADOS GALVANIZADOS
            { nome: "Tubo Quadrado Galv. 15 X 15 1.25MM(18)", preco: 35.99 },
            { nome: "Tubo Quadrado Galv. 20 X 20 0.95MM(20)", preco: 40.99 },
            { nome: "Tubo Quadrado Galv. 20 X 20 1.25MM(18)", preco: 50.20 },
            { nome: "Tubo Quadrado Galv. 20 X 20 1.55MM(16)", preco: 59.26 },
            { nome: "Tubo Quadrado Galv. 25 X 25 0.95MM(20)", preco: 55.00 },
            { nome: "Tubo Quadrado Galv. 25 X 25 1.25MM(18)", preco: 63.20 },
            { nome: "Tubo Quadrado Galv. 25 X 25 1.55MM(16)", preco: 77.25 },
            { nome: "Tubo Quadrado Galv. 30 X 30 0.95MM(20)", preco: 62.60 },
            { nome: "Tubo Quadrado Galv. 30 X 30 1.25MM(18)", preco: 77.68 },
            { nome: "Tubo Quadrado Galv. 30 X 30 1.55MM(16)", preco: 91.99 },
            { nome: "Tubo Quadrado Galv. 40 X 40 1.25MM(18)", preco: 104.90 },
            { nome: "Tubo Quadrado Galv. 40 X 40 1.55MM(16)", preco: 128.00 },
            { nome: "Tubo Quadrado Galv. 50 X 50 1.25MM(18)", preco: 129.99 },
            { nome: "Tubo Quadrado Galv. 50 X 50 1.55MM(16)", preco: 158.30 },

            // TUBOS RETANGULARES GALVANIZADOS
            { nome: "Tubo Retangular Galv. 20 X 30 0.95MM(20)", preco: 50.40 },
            { nome: "Tubo Retangular Galv. 20 X 30 1.25MM(18)", preco: 62.99 },
            { nome: "Tubo Retangular Galv. 20 X 30 1.55MM(16)", preco: 76.91 },
            { nome: "Tubo Retangular Galv. 20 X 40 0.95MM(20)", preco: 63.29 },
            { nome: "Tubo Retangular Galv. 20 X 40 1.25MM(18)", preco: 76.30 },
            { nome: "Tubo Retangular Galv. 20 X 40 1.55MM(16)", preco: 93.30 },
            { nome: "Tubo Retangular Galv. 20 X 50 1.25MM(18)", preco: 95.30 },
            { nome: "Tubo Retangular Galv. 20 X 50 1.55MM(16)", preco: 104.50 },
            { nome: "Tubo Retangular Galv. 30 X 40 0.95MM(20)", preco: 70.55 },
            { nome: "Tubo Retangular Galv. 30 X 40 1.25MM(18)", preco: 90.90 },
            { nome: "Tubo Retangular Galv. 30 X 40 1.55MM(16)", preco: 108.99 },
            { nome: "Tubo Retangular Galv. 30 X 50 0.95MM(20)", preco: 86.60 },
            { nome: "Tubo Retangular Galv. 30 X 50 1.25MM(18)", preco: 96.30 },
            { nome: "Tubo Retangular Galv. 30 X 50 1.55MM(16)", preco: 125.99 },

            // TUBOS REDONDOS INDUSTRIAIS GALVANIZADOS
            { nome: "Tubo Redondo Ind. Galv. 5/8 X 0.95MM(20)", preco: 25.60 },
            { nome: "Tubo Redondo Ind. Galv. 5/8 X 1.25MM(18)", preco: 35.99 },
            { nome: "Tubo Redondo Ind. Galv. 3/4 X 1.25MM(18)", preco: 37.20 },
            { nome: "Tubo Redondo Ind. Galv. 3/4 X 1.55MM(16)", preco: 45.99 },
            { nome: "Tubo Redondo Ind. Galv. 7/8 X 1.25MM(18)", preco: 44.30 },
            { nome: "Tubo Redondo Ind. Galv. 7/8 X 1.55MM(16)", preco: 49.50 },
            { nome: "Tubo Redondo Ind. Galv. 1POL X 1.25MM(18)", preco: 49.95 },
            { nome: "Tubo Redondo Ind. Galv. 1POL X 1.55MM(16)", preco: 62.49 },
            { nome: "Tubo Redondo Ind. Galv. 1.1/4 X 1.25MM(18)", preco: 65.99 },
            { nome: "Tubo Redondo Ind. Galv. 1.1/4 X 1.55MM(16)", preco: 78.30 },
            { nome: "Tubo Redondo Ind. Galv. 1.1/2 X 1.25MM(18)", preco: 74.99 },
            { nome: "Tubo Redondo Ind. Galv. 1.1/2 X 1.55MM(16)", preco: 96.30 },
            { nome: "Tubo Redondo Ind. Galv. 2POL X 1.25MM(18)", preco: 99.99 },
            { nome: "Tubo Redondo Ind. Galv. 2POL X 1.55MM(16)", preco: 123.99 },

            // FERROS REDONDOS E QUADRADOS ZINCADOS
            { nome: "Ferro Redondo Zincado 1/4", preco: 18.90 },
            { nome: "Ferro Redondo Zincado 5/16", preco: 27.90 },
            { nome: "Ferro Redondo Zincado 3/8", preco: 41.90 },
            { nome: "Ferro Redondo Zincado 1/2", preco: 69.89 },
            { nome: "Ferro Quadrado Zincado 5/16", preco: 40.65 },
            { nome: "Ferro Quadrado Zincado 1/2", preco: 100.95 },

            // FERROS CHATOS ZINCADOS
            { nome: "Ferro Chato Zincado 3/8 X 1/8", preco: 17.35 },
            { nome: "Ferro Chato Zincado 1/2 X 1/8", preco: 25.09 },
            { nome: "Ferro Chato Zincado 1/2 X 3/16", preco: 33.98 },
            { nome: "Ferro Chato Zincado 5/8 X 1/8", preco: 28.92 },
            { nome: "Ferro Chato Zincado 5/8 X 3/16", preco: 42.70 },
            { nome: "Ferro Chato Zincado 3/4 X 1/8", preco: 34.70 },
            { nome: "Ferro Chato Zincado 3/4 X 3/16", preco: 51.39 },
            { nome: "Ferro Chato Zincado 7/8 X 1/8", preco: 39.80 },
            { nome: "Ferro Chato Zincado 7/8 X 3/16", preco: 60.00 },
            { nome: "Ferro Chato Zincado 1 X 1/8", preco: 45.99 },
            { nome: "Ferro Chato Zincado 1 X 3/16", preco: 68.68 },
            { nome: "Ferro Chato Zincado 1 X 1/4", preco: 90.86 },
            { nome: "Ferro Chato Zincado 1.1/4 X 1/8", preco: 57.99 },
            { nome: "Ferro Chato Zincado 1.1/4 X 3/16", preco: 86.60 },
            { nome: "Ferro Chato Zincado 1.1/4 X 1/4", preco: 114.90 },
            { nome: "Ferro Chato Zincado 1.1/2 X 1/8", preco: 77.85 },
            { nome: "Ferro Chato Zincado 1.1/2 X 3/16", preco: 102.91 },
            { nome: "Ferro Chato Zincado 1.1/2 X 1/4", preco: 137.37 },
            { nome: "Ferro Chato Zincado 2 X 1/8", preco: 91.82 },
            { nome: "Ferro Chato Zincado 2 X 3/16", preco: 137.37 },
            { nome: "Ferro Chato Zincado 2 X 1/4", preco: 182.99 },

            // CANTONEIRAS ZINCADAS
            { nome: "Cantoneira Zincada 1/2 X 1/8", preco: 39.99 },
            { nome: "Cantoneira Zincada 3/4 X 1/8", preco: 63.90 },
            { nome: "Cantoneira Zincada 7/8 X 1/8", preco: 75.99 },
            { nome: "Cantoneira Zincada 1 X 1/8", preco: 86.50 },
            { nome: "Cantoneira Zincada 1 X 3/16", preco: 125.75 },
            { nome: "Cantoneira Zincada 1.1/4 X 1/8", preco: 109.20 },
            { nome: "Cantoneira Zincada 1.1/4 X 3/16", preco: 159.99 },
            { nome: "Cantoneira Zincada 1.1/4 X 1/4", preco: 208.20 },
            { nome: "Cantoneira Zincada 1.1/2 X 3/16", preco: 195.10 },
            { nome: "Cantoneira Zincada 1.1/2 X 1/4", preco: 252.95 },
            { nome: "Cantoneira Zincada 2 X 3/16", preco: 263.75 },
            { nome: "Cantoneira Zincada 2 X 1/4", preco: 345.90 },

            // ACESSÓRIOS E COMPLEMENTOS
            { nome: "Sapata Regulável", preco: 2.50, porUnidade: true },
            { nome: "Orelhinha (Fixação)", preco: 0.50, porUnidade: true },
            { nome: "Tampa de Tubo (Ponteira)", preco: 1.50, porUnidade: true }
        ];

        let materiaisAdicionados = [];
        let materialSelecionado = null; 

        function formatarMoeda(valor) {
            return valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        }

        function filtrarMateriais() {
            const termo = document.getElementById('input-busca').value.toLowerCase();
            const dropdown = document.getElementById('dropdown-materiais');
            dropdown.innerHTML = '';
            materialSelecionado = null; 

            if (termo.length < 1) {
                dropdown.classList.add('hidden');
                return;
            }

            const resultados = dbMateriais.filter(mat => mat.nome.toLowerCase().includes(termo));

            if (resultados.length > 0) {
                dropdown.classList.remove('hidden');
                resultados.forEach((mat) => {
                    const li = document.createElement('li');
                    li.className = "p-3 hover:bg-zinc-700 cursor-pointer text-sm border-b border-zinc-700 flex justify-between items-center";
                    const infoPreco = mat.porUnidade ? `R$ ${mat.preco.toFixed(2)} / un` : `R$ ${mat.preco.toFixed(2)} / 6m`;
                    li.innerHTML = `<span class="flex-1">${mat.nome}</span> <span class="text-gold-400 text-xs ml-2 whitespace-nowrap">${infoPreco}</span>`;
                    
                    li.onclick = () => { selecionarMaterial(mat); };
                    dropdown.appendChild(li);
                });
            } else {
                dropdown.classList.remove('hidden');
                dropdown.innerHTML = '<li class="p-3 text-sm text-gray-500">Nenhum material encontrado.</li>';
            }
        }

        function selecionarMaterial(mat) {
            materialSelecionado = mat;
            document.getElementById('input-busca').value = mat.nome;
            document.getElementById('dropdown-materiais').classList.add('hidden');
            
            if (mat.porUnidade) {
                document.getElementById('label-quantidade').innerText = 'Quantidade (Unid.)';
                document.getElementById('input-metros').placeholder = 'Ex: 4';
            } else {
                document.getElementById('label-quantidade').innerText = 'Metros Usados';
                document.getElementById('input-metros').placeholder = 'Ex: 2.5';
            }
            
            document.getElementById('input-metros').focus(); 
        }

        document.addEventListener('click', function(event) {
            const isClickInside = document.getElementById('input-busca').contains(event.target) || document.getElementById('dropdown-materiais').contains(event.target);
            if (!isClickInside) {
                document.getElementById('dropdown-materiais').classList.add('hidden');
            }
        });

        function adicionarMaterial() {
            if (!materialSelecionado) {
                alert("Por favor, busque e selecione um material na lista.");
                document.getElementById('input-busca').focus();
                return;
            }

            const quantidade = parseFloat(document.getElementById('input-metros').value);

            if (isNaN(quantidade) || quantidade <= 0) {
                alert("Por favor, insira a quantidade utilizada.");
                return;
            }

            let custoCalculado = 0;
            let labelUnidade = "";

            if (materialSelecionado.porUnidade) {
                custoCalculado = materialSelecionado.preco * quantidade;
                labelUnidade = quantidade > 1 ? "unidades" : "unidade";
            } else {
                custoCalculado = (materialSelecionado.preco / 6) * quantidade;
                labelUnidade = "metros";
            }

            materiaisAdicionados.push({
                nome: materialSelecionado.nome,
                quantidade: quantidade,
                labelUnidade: labelUnidade,
                custo: custoCalculado
            });

            document.getElementById('input-busca').value = '';
            document.getElementById('input-metros').value = '';
            document.getElementById('label-quantidade').innerText = 'Metros / Qtd.';
            materialSelecionado = null;
            
            atualizarLista();
            calcularTotal();
        }

        function removerMaterial(index) {
            materiaisAdicionados.splice(index, 1);
            atualizarLista();
            calcularTotal();
        }

        function atualizarLista() {
            const container = document.getElementById('lista-materiais');
            container.innerHTML = ''; 

            if (materiaisAdicionados.length === 0) {
                container.innerHTML = '<p class="text-xs text-gray-600 italic py-2">Nenhum material adicionado ainda.</p>';
                return;
            }

            materiaisAdicionados.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = "flex justify-between items-center bg-zinc-900 rounded-md p-3 border border-white/5";
                div.innerHTML = `
                    <div class="pr-2">
                        <p class="text-[11px] md:text-sm text-white leading-tight">${item.nome}</p>
                        <p class="text-[10px] md:text-xs text-gold-400 mt-1">${item.quantidade} ${item.labelUnidade}</p>
                    </div>
                    <div class="flex items-center gap-3">
                        <span class="text-xs md:text-sm font-semibold font-mono">${formatarMoeda(item.custo)}</span>
                        <button onclick="removerMaterial(${index})" class="text-red-500 hover:text-red-400 bg-red-500/10 p-2 rounded-md"><i class="ph ph-trash text-lg"></i></button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function calcularTotal() {
            // 1. Total Ferro e Peças
            const totalMateriais = materiaisAdicionados.reduce((acc, item) => acc + item.custo, 0);

            // 2. Total Serviços
            const qtdPintura = parseFloat(document.getElementById('qtd-pintura').value) || 0;
            const valorPintura = parseFloat(document.getElementById('valor-pintura').value) || 0;
            const totalPintura = qtdPintura * valorPintura;

            const qtdSoldas = parseFloat(document.getElementById('qtd-soldas').value) || 0;
            const valorSolda = parseFloat(document.getElementById('valor-solda').value) || 0;
            const totalMaoDeObra = qtdSoldas * valorSolda;

            const totalServico = totalPintura + totalMaoDeObra;

            // 3. Custo Base
            const custoBase = totalMateriais + totalServico;

            // 4. Margem de Lucro Final
            const percentualMargem = parseFloat(document.getElementById('margem-lucro').value) || 0;
            const valorMargem = custoBase * (percentualMargem / 100);
            
            // 5. Preço Final
            const precoFinal = custoBase + valorMargem;

            // Atualiza Rodapé Fixo
            document.getElementById('resumo-custo').innerText = formatarMoeda(custoBase);
            document.getElementById('resumo-margem').innerText = formatarMoeda(valorMargem);
            document.getElementById('preco-final').innerText = formatarMoeda(precoFinal);

            // Atualiza Detalhamento Interno (O Espelho)
            document.getElementById('detalhe-materiais').innerText = formatarMoeda(totalMateriais);
            document.getElementById('detalhe-pintura').innerText = formatarMoeda(totalPintura);
            document.getElementById('detalhe-solda').innerText = formatarMoeda(totalMaoDeObra);
            document.getElementById('detalhe-margem').innerText = formatarMoeda(valorMargem);
            document.getElementById('detalhe-total').innerText = formatarMoeda(precoFinal);
        }

        function limparTudo() {
            if(confirm("Tem certeza que deseja limpar todo o orçamento?")) {
                materiaisAdicionados = [];
                document.getElementById('input-busca').value = '';
                document.getElementById('input-metros').value = '';
                document.getElementById('qtd-soldas').value = '0';
                document.getElementById('qtd-pintura').value = '0';
                document.getElementById('margem-lucro').value = '20';
                document.getElementById('label-quantidade').innerText = 'Metros / Qtd.';
                materialSelecionado = null;
                atualizarLista();
                calcularTotal();
            }
        }
    </script>
</body>
</html>